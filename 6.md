# データベース理論入門と演習

## データベースのデータの保存方法と検索効率
口頭で行う。

ちなみにデータベースの詳細について知りたければ
http://postd.cc/how-does-a-rdb-work-1/
などを読むと良い。
また、データベースは非常に理論の整備が進んでいる分野であり、各種教科書が役に立つ。

### 二分木

### 多分木

### B+木

### インデックス

## SQLの効率的で安全な構築

SQL文の構築をPythonの文字列操作を使って行うことは面倒であり、危険である。
たとえば

```
'select * from User where id='+str(input)
```

というSQLがあったとする。
ここでinputにたとえば

```
input='1 or id > 1'
```

とすれば、すべてのユーザのデータが取得されてしまう。
こういう自体を防ぐために安全にSQLを構築する方法がexecuteメソッドには備わっている。
「位置パラメータ」を使う方法、「名前付きパラメータ」を使う2つの方法が用意されているが、
今回は使う機会が多いと思われる名前付きパラメータを用いる方法を紹介する。
前回作成したBooksテーブルが入っているデータベースを用いて、

```
#!/usr/bin/python3
# -*- coding: utf-8 -*-

from sqlite3 import connect,Row

con = connect('test.db')
#取得する形式をディクショナリに
con.row_factory = Row

book_name='ModernC++Design'

cur = con.cursor()
cur.execute('select * from Books where name=:book_name',{'book_name':book_name})
books = cur.fetchall()
for book in books:
    print(book['name']+"の価格は"+str(book['price'])+"です")

```

のようにディクショナリを渡すことで行うことができる。
また、クエリ内で使いたい名前はクエリ内で「:」を先頭につけることで参照できる(この例だと「:book_name」)

## 問題
商品の在庫管理システムを考える。
このシステムでは管理者用の商品の追加・削除ページ、商品の価格の修正ページ、商品の検索機能がある。
※なお、★のついた問題は発展的なもの、★★は結構程度の高いもの。

- (商品ID,商品名,価格)をcolumとしてもつテーブルを作成せよ
- 商品の追加ページを作成せよ
- 商品の検索ページおよび検索結果ページを作成せよ
- 商品の価格修正ページを作成せよ(ヒント:SQLのupdate文を用いる)
- 商品の削除ページを作成せよ(ヒント:SQLのdeleteを用いる)
- ★商品の検索ページで、プルダウンメニューでid順、価格順を選択しソートできるようにせよ(ヒント:order byを使う)
- ★検索結果ページで商品を選択し削除できるような仕組みを作れ(htmlのaタグを用いてGETメソッドで削除ページに飛ばす、formの隠し属性を使うなど色々と方法が考えられる)
- ★★正規化について調べ適切なテーブル構造を考えよ
- ★★どのようにインデックスを貼れば効率的になるか考えインデックスをはりその効率について実際に確かめよ(ヒント:create index,マルチカラムインデックス、explain)

