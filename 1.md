# Webアプリケーション入門

## 本講座について
Pythonの文法の解説からはじめ、 本の貸出システムを題材にして実用的な内容まで学ぶことで、Webアプリケーションの作成(特にプログラミング)ができるようになることを目的として行う。

### Webアプリケーションとは何かと本講座で扱う範囲
Webアプリケーションの例としてはwikiやブログ、掲示板、通販サイト、Googleカレンダー等々がある。

これらの例を見てわかるようにWebアプリケーションは一般にブラウザを用いて「Webサイトを見る」ことによって利用することができる。

プログラミング的な視点でもう少し整理するとWebアプリケーションはサーバサイドのアプリケーションとクライアントサイドのアプリケーションという風にわかれ、そのあいだの通信にネットワークをつかう。
また、通信は多くの場合HTTPあるいはHTTPSプロトコルに基づいて行われる。

Webアプリケーションは下記の要素で構成される。

* クライアントサイドアプリケーション
* サーバサイドアプリケーション
* インフラ(サーバ、各種ミドルウェア)

クライアントサイドアプリケーションは、ようするにブラウザを開いた時に見える見た目の部分を制御するアプリケーションだ。
一般的にユーザの手元にダウンロードされて実行される。

一方、手元にはダウンロードされず、サーバ上で実行されるアプリケーションがサーバ再度アプリケーションだ。
これは以下に述べるデータベースサーバ(DBサーバ)と呼ばれる、データを保存しておくプログラムからデータを取り出し、
それに則ってクライアントに提供されるデータの一部を整形して出力するという役割を担う。

最後にあまり馴染みがないのはインフラかもしれない。
これはサーバサイドアプリケーション以外のアプリケーションを動かす上で重要なサーバ上で動くプログラムで、
HTTPプロトコルを処理するのに特化したWebサーバと呼ばれるアプリケーション、
大量のデータを効率よく安全に検索・保存することに特化したDBサーバとなどのアプリケーションなどが当たり、
よくある処理を専門的に効率よく動かすためのものである。
また、OS・ネットワークなどもこの範疇に入る。

本講座では上記の3つのうちとくにサーバサイドアプリケーションを中心に扱う。
なお、本講座では時間の都合上下記は扱わない。

* 詳細なサーバ構築
* サーバの運用・障害対応

また、講師ができないので下記も扱わない
(他に講師をしてくれる人がいればやるかも...)

* クライアントサイドアプリケーション(Webデザイン)

## 環境の導入
本講座ではサーバサイドアプリケーションを実装するための言語として、Pythonを用いる。
そのため、まずはPythonおよび周辺環境をWindowsに導入する際の手順を簡単に説明をする。

Macや各種GNU/Linuxディストリビューション、あるいは他のOSを使っている人は
パッケージマネージャ等から簡単に導入できるはずなので特に解説はしない。

### なぜPythonか?
Pythonのコードは黒魔術的な要素が少なく、また見た目にも非常に読みやすい。
また、文法は平易であるが、大規模なアプリケーション開発にも十分実用に耐えうる。

したがって、本講座ではPythonを採用した。

### Pythonのインストール
下記からOSにあったPythonをDLしてインストールする(Python3.4.3です)

* [Windows x86-64 MSI installer](https://www.python.org/ftp/python/3.4.3/python-3.4.3.amd64.msi)
* [Windows x86 MSI installer](https://www.python.org/ftp/python/3.4.3/python-3.4.3.msi)

次にコマンドプロンプトを管理者ユーザで開き、下記を入力する。
(もしC:\Python34以外のディレクトリを指定した人はそこをかえること！また、危険なコマンドなのでコピペしたほうが良い。)

```
SETX /M PATH "%PATH%;C:\Python34;C:\Python34\Tools;C:\Python34\Scripts"
```

別のコマンドプロンプト(管理者ユーザでなくてよい)を開き、pythonと入力して「>>>」とかが表示された画面(Pythonインタプリタ)が表示されれば成功だ。

### Hello World
Pythonインタプリタを起動して
```
print("Hello World!!")
```
とすればよい。

### PyCharm(あるいはお好きなIDE・エディタの導入)
Pythonの統合開発環境(IDE)の一つとしてPyCharmが存在する。
本講座ではまず、PyCharmの導入方法を紹介する。
(一例として紹介するだけなので各自好きなエディタ・IDEをつかってほしい。)
ちなみに他にはNinjaIDE, vimなどがある。

下記から自分のOSにあったものをDLしインストールする。
学生ならばProfessional版が無料で使える。

* https://www.jetbrains.com/pycharm/



```
#!/usr/bin/python3
# -*- coding: utf-8 -*-

print("Hello World!!")
```
と書こう。

そしてSift+F10で下のウィンドウに実行結果が表示される。

また、コマンドプロンプトやターミナルからスクリプトファイルのあるディレクトリにて

```
python3 hello.py
```

うまく行かない場合、あるいは

```
python hello.py
```

とすることでも実行できる。

## 変数
Pythonにおける変数はC言事は違い、オブジェクトに付けるラベルである。
しかし、最初のうちはC言語の代入と変わらないという認識をしていて問題ない。
また、型を特に明示する必要はなく代入した時点で型が決定される。

以下のサンプルを見てみよう。

```
#!/usr/bin/python3
# -*- coding: utf-8 -*-

a = 2
b = 3

print(a+b)
print(a-b)
print(a*4)
print(a**b)
print(a/b)
print(a//b)
print(a%b)

c = "string"

print(c)

#This is comment
#error!!
#print(c+a)
print(c+str(a))
```

特筆すべき点としてははまず\*\*で累乗ができる。

また、注意して欲しいのが割り算の結果だ。
「/」をつかうと整数同士の割り算でも結果がfloat型となってしまうので注意しよう。
(プログラマにとって)普通の割り算の結果、つまり整数型で返して欲しい際は「//」演算子
を用いる。

また、Pythonはスクリプト言語の中ではわりと型が厳格であるので、コメントアウトされているprint関数の部分のコメントアウトを外すと型エラーとなる。
結合したい場合はstr関数を用いて、キャスト(正確にはstringオブジェクトの構築)をしてあげるとよい。

## Flask

FlaskとはPythonの軽量なウェブアプリケーションフレームワークである。
平たくいってしまえばWebアプリケーションを作りやすくするためのライブラリのようなものと思ってもらえれば良い。

### 導入

コマンドプロンプトから下記を入力する。
(LinuxやMacの場合pip3コマンドを用いる必要があるかもしれない)

```
pip install flask
```

これでflaskが使えるようになる。

Pythonインタプリタで

```
import flask
```
として何もエラーがでなければ正常にインストールされている。

### FlaskでHello World

エディタで下記を入力して

```
#!/usr/bin/python3
# -*- coding: utf-8 -*-

from flask import Flask
app = Flask(__name__)

@app.route("/")
def hello():
    return "Hello World!"

if __name__ == "__main__":
    app.run(debug=True)
```

として実行(Atomの場合、例のごとくctrl+r)してブラウザで http://127.0.0.1:5000/ を開くと「Hello World!」と表示されるはずだ。

細かい文法については今後説明していくが、大事なのはreturnの後に書かれた文字列(ここではHello World)
が表示されるというポイントだ。
また、Pythonではインデントが文法上非常に重要だ。インデントを間違えないようにしてほしい。

次に入力を受け取るようなプログラムを書いてみよう。

```
#!/usr/bin/python3
# -*- coding: utf-8 -*-


from flask import Flask,request

app = Flask(__name__)

@app.route('/')
def hello_world():
    who = request.args.get("who")
    return who

if __name__ == '__main__':
    app.run(debug=True)
```

実行して http://127.0.0.1:5000/?who=taro にアクセスしてほしい。
きっと「taro」と表示されたはずだ。
詳細はフォームというものを紹介するところで書くがHTTPプロトコルでは「?」の後に
「パラメータ名(ここではwho)=値(ここではtaro)」のようにすることでパラメータを受け取ることができる。
Python側ではそれを「request.args.get」をつかってパラメータ名を指定して取り出すことができる。

## 問題

- 自分の名前を出力するようなプログラムを書け
- 上記をブラウザに表示できるようなプログラムをかけ
- http://127.0.0.1:5000/?name=hoge にアクセスされたとき(hogeは任意)「Hello hoge!」と表示するようなプログラムをかけ
- HTTPプロトコルではURLのパラメータ部分を「&」で区切ることで複数のパラメータを渡すことができる。http://127.0.0.1:5000/?a=1&b=1 にアクセスされたとき2と表示するような、つまりaとbの加算を実行するプログラムをかけ。
