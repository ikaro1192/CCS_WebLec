# Webアプリケーション入門

## 本講座について
Pythonの文法の解説からはじめ、 本の貸出システムを題材にして実用的な内容まで学ぶことで、
Webアプリケーションの作成(特にプログラミング)ができるようになることを目的として行う。

### Webアプリケーションとは何かと本講座で扱う範囲
Webアプリケーションの例としてはwikiやブログ、掲示板、通販サイト、Googleカレンダー等々がある。

これらの例を見てわかるようにWebアプリケーションは一般にブラウザを用いて「Webサイトを見る」
ことによって利用することができる。

プログラミング的な視点でもう少し整理するとWebアプリケーションは
サーバサイドのアプリケーションと
クライアントサイドのアプリケーションという風にわかれ、そのあいだの通信にネットワークをつかう。
また、通信は多くの場合HTTPあるいはHTTPSプロトコルに基づいて行われる。

Webアプリケーションは下記の要素で構成される。

* クライアントサイドアプリケーション
* サーバサイドアプリケーション
* インフラ(サーバ、各種ミドルウェア)

クライアントサイドアプリケーションは、ようするにブラウザを開いた時に
見える見た目の部分を制御するアプリケーションだ。
一般的にユーザの手元にダウンロードされて実行される。

一方、手元にはダウンロードされず、サーバ上で実行されるアプリケーションが
サーバ再度アプリケーションだ。
これは以下に述べるデータベースサーバ(DBサーバ)と呼ばれる、
データを保存しておくプログラムからデータを取り出し、
それに則ってクライアントに提供されるデータの一部を整形して出力するという
役割を担う。

最後にあまり馴染みがないのはインフラかもしれない。
これはサーバサイドアプリケーション以外のアプリケーションを動かす上で重要なサーバ上で動くプログラムで、
HTTPプロトコルを処理するのに特化したWebサーバと呼ばれるアプリケーション、
大量のデータを効率よく安全に検索・保存することに特化したDBサーバとなどのアプリケーションなどが当たり、
よくある処理を専門的に効率よく動かすためのものである。
また、OS・ネットワークなどもこの範疇に入る。

本講座では上記の3つのうちとくにサーバサイドアプリケーションを中心に扱う。
なお、本講座では時間の都合上下記は扱わない。

* 詳細なサーバ構築
* サーバの運用・障害対応

また、講師ができないので下記も扱わない
(他に講師をしてくれる人がいればやるかも...)

* クライアントサイドアプリケーション(Webデザイン)

## 環境の導入
本講座ではサーバサイドアプリケーションを実装するための言語として、
Pythonを用いる。
そのため、まずはPythonおよび周辺環境をWindowsに導入する際の手順を簡単に説明をする。

Macや各種GNU/Linuxディストリビューション、あるいは他のOSを使っている人は
パッケージマネージャ等から簡単に導入できるはずなので特に解説はしない。

### なぜPythonか?
Pythonのコードは黒魔術的な要素が少なく、
また見た目にも非常に読みやすい。
また、文法は平易であるが、
大規模なアプリケーション開発にも十分実用に耐えうる。

したがって、本講座ではPythonを採用した。

### Pythonのインストール
下記からOSにあったPythonをDLしてインストールする(Python3.4.3です)

* [Windows x86-64 MSI installer](https://www.python.org/ftp/python/3.4.3/python-3.4.3.amd64.msi)
* [Windows x86 MSI installer](https://www.python.org/ftp/python/3.4.3/python-3.4.3.msi)

次にコマンドプロンプトを管理者ユーザで開き、
下記を入力する。
(もしC:\Python34以外のディレクトリを指定した人はそこをかえること！
また、危険なコマンドなのでコピペしたほうが良い。)

```
SETX /M PATH "%PATH%;C:\Python34;C:\Python34\Tools;C:\Python34\Scripts"
```

別のコマンドプロンプト(管理者ユーザでなくてよい)を開き、
pythonと入力して「>>>」とかが表示された画面(Pythonインタプリタ)が表示されれば成功だ。

### Hello World
Pythonインタプリタを起動して
```
print("Hello World!!")
```
とすればよい。

### Atom(あるいはお好きなエディタの導入)
vimのほうがよいが、なれないと使いにくい(慣れればとても使いやすい)ので、
Atomというエディタを導入する。(一例として紹介するだけで
別にAtomでなくてもいいと思うし各自好きなエディタをつかってほしい。)

下記から自分のOSにあったものをDLしインストールする

* https://atom.io/

次にAtomにPythonを書きやすくするためのプラグインをいくつか導入する。
「ctrl+,」とエディタ上で入力しあたらしいペインが開いたらInstallをクリック。
そこから下記プラグインを検索、インストールする。

* atom-runner
* auto-complete-paths
* auto-complete-python
* autocomplete-plus

特に再起動なしで使えるようになる。
最低限これだけいれとけばいいが、他にも色々と便利なプラグインがあるので
気になる人は導入してみるとよい。

おすすめは

* vim-mode
* ex-mode
* vim-mode-clipboard-plus
* vim-mode-visual-block

だ。これをいれるとだいぶvimっぽくなりまともなエディタという感じがしてくる
(もちろん本物のvimにはかなわないが...)

導入できたらFile→New Fileで「hello.py」という名前のファイルを適当な場所に
つくり、そこに
```
# -*- coding: utf-8 -*-

print("Hello World!!")
```
と書こう。

そして「alt+r」を押すと新規ペインが開きそこに実行結果が表示される。
ESCを押すことでペインは閉じられる。

## 変数
Pythonにおける変数はC言事は違い、オブジェクトに付けるラベルのようなものだ。
しかし、実用上、C言語の代入と変わらないという認識をしていて問題ない。
また、型を特に明示する必要はなく、代入した時点で型が決定される。

とりあえず、以下のサンプルを見てみよう。

```
# -*- coding: utf-8 -*-

a = 2
b = 3

print(a+b)
print(a-b)
print(a*4)
print(a**b)
print(a/b)
print(a//b)
print(a%b)

c = "string"

print(c)

#This is comment
#error!!
#print(c+a)
print(c+str(a))
```

特に問題ないだろう。
特筆すべき点としてははまず**で累乗ができる。

また、注意して欲しいのが割り算の結果だ。
「/」をつかうと整数同士の割り算でも結果がfloat型となってしまうので注意しよう。
(プログラマにとって)普通の割り算の結果、つまり整数型で返して欲しい際は「//」演算子
を用いる。

また、Pythonはスクリプト言語の中ではわりと型が厳格であるので、
コメントアウトされているprint関数の部分のコメントアウトを外すと
型エラーとなる。
結合したい場合はstr関数を用いて、キャスト(正確にはstringオブジェクトの構築)をしてあげるとよい。

## Flask

FlaskとはPythonの軽量なウェブアプリケーションフレームワークである。
平たくいってしまえばWebアプリケーションを作りやすくするためのライブラリのようなもの
と思ってもらえれば良い。

### 導入

コマンドプロンプトから下記を入力する。

```
pip install flask
```

これでflaskが使えるようになる。

Pythonインタプリタで

```
import flask
```
として何もエラーがでなければ正常にインストールされている。

### FlaskでHello World

エディタで下記を入力して

```
from flask import Flask
app = Flask(__name__)

@app.route("/")
def hello():
    return "Hello World!"

    if __name__ == "__main__":
        app.run(debug=True)
```

として実行(Atomの場合、例のごとくctrl+r)してブラウザで http://127.0.0.1:5000/ を開くと「Hello World!」と表示されるはずだ。

細かい文法については今後説明していくが、大事なのはreturnの後に書かれた文字列(ここではHello World)
が表示されるというポイントだ。
また、Pythonではインデントが文法上非常に重要だ。インデントを間違えないようにしてほしい。

次に入力を受け取るようなプログラムを書いてみよう。

```
from flask import Flask,request

app = Flask(__name__)

@app.route('/')
def hello_world():
    who = request.args.get("who")
    return who

if __name__ == '__main__':
    app.run(debug=True)
```

実行して http://127.0.0.1:5000/?who=taro にアクセスしてほしい。
きっと「taro」と表示されたはずだ。
詳細はフォームというものを紹介するところで書くがHTTPプロトコルでは「?」の後に
「パラメータ名(ここではwho)=値(ここではtaro)」のようにすることでパラメータを受け取ることができる。
Python側ではそれを「request.args.get」をつかってパラメータ名を指定して取り出すことができる。

##問題

- 自分の名前を出力するようなプログラムを書け
- 上記をブラウザに表示できるようなプログラムをかけ
- http://127.0.0.1:5000/?name=hoge にアクセスされたとき(hogeは任意)Hello hoge!と表示するようなプログラムをかけ
- HTTPプロトコルではURLのパラメータ部分を「&」で区切ることで複数のパラメータを渡すことができる。http://127.0.0.1:5000/?a=1&b=1 にアクセスされたときと2表示するような、つまりaとbの加算を実行するプログラムをかけ。
